<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Management</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <style>
        /* Your existing styles */
		body {
			background-color: #1b1e23; /* Dark background color */
			color: #ffffff; /* Light text color */
		}

		/* Adjust the background and text color of the table */
		table.dataTable {
			background-color: #000000; /* Black background color for the table */
			color: #ffffff; /* Light text color for the table */
		}

		/* Adjust the color of table headers */
		table.dataTable thead th {
			color: #ffffff; /* Light text color for table headers */
		}

		/* Adjust the color of table rows */
		table.dataTable tbody tr {
			background-color: #000000; /* Black background color for all rows */
			color: #ffffff; /* Light text color for all rows */
		}

		.custom-row-class {
			background-color: #444444 !important; /* Dark background color for highlighted rows */
		}

		table.dataTable tbody td:first-child {
			background-color: #000000; /* Black background color for the first column */
			color: #ffffff; /* Light text color for the first column */
		}

		/* Override the default DataTables stripe color */
		table.dataTable tbody tr.odd,
		table.dataTable tbody tr.odd:hover {
			background-color: #555555 !important; /* Darker background color for odd rows */
		}

		/* Adjust the color of DataTables pagination controls */
		.dataTables_paginate .paginate_button {
			color: #ffffff !important; /* Light text color for pagination controls */
		}

		.dataTables_paginate .paginate_button:hover {
			color: #ffffff !important; /* Light text color for pagination controls on hover */
		}

		/* Adjust the color of other DataTables elements */
		.dataTables_info,
		.dataTables_length label,
		.dataTables_filter label,
		.dataTables_processing,
		.dataTables_paginate,
		.dataTables_paginate span a {
			color: #ffffff !important; /* Light text color for other DataTables elements */
		}

		.dataTables_paginate span .current {
			background-color: #555555 !important; /* Darker background color for the current page number */
			color: #ffffff !important; /* Light text color for the current page number */
		}

		/* Adjust the color of DataTables length menu */
		.dataTables_length label select {
			color: #ffffff !important; /* Light text color for length menu */
			background-color: #444444 !important; /* Dark background color for length menu */
		}

		/* Adjust the color of DataTables pagination buttons */
		.dataTables_paginate .paginate_button {
			color: #ffffff !important; /* Light text color for pagination buttons */
		}

		.dataTables_paginate .paginate_button:hover {
			color: #ffffff !important; /* Light text color for pagination buttons on hover */
		}

		/* Adjust the color of DataTables pagination controls at the bottom right */
		.dataTables_wrapper .dataTables_paginate .paginate_button {
			color: #ffffff !important; /* Light text color for pagination controls */
		}

		.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
			color: #ffffff !important; /* Light text color for pagination controls on hover */
		}

		/* Adjust the color of DataTables previous button */
		.dataTables_wrapper .dataTables_paginate .previous {
			color: #ffffff !important; /* Light text color for the Previous button */
		}

		.dataTables_wrapper .dataTables_paginate .previous:hover {
			color: #ffffff !important; /* Light text color for the Previous button on hover */
		}

		/* Adjust the color of DataTables search input */
		.dataTables_wrapper .dataTables_filter input {
			color: #ffffff !important; /* Light text color for the search input */
			background-color: #444444 !important; /* Dark background color for the search input */
		}

		/* Adjust the color of DataTables search input on focus */
		.dataTables_wrapper .dataTables_filter input:focus {
			color: #ffffff !important; /* Light text color for the search input on focus */
			background-color: #555555 !important; /* Darker background color for the search input on focus */
		}

		#balanceTable {
			margin: 20px auto;
		}
		
		
		
		

		table.dataTable thead th.sorting,
		table.dataTable thead th.sorting_asc,
		table.dataTable thead th.sorting_desc,
		table.dataTable thead th.sorting_asc_disabled,
		table.dataTable thead th.sorting_desc_disabled {
			background-color: #000000 !important; /* Darker background color for the filtered column header */
			color: #ffffff !important; /* Light text color for the filtered column header */
		}
		table.dataTable tbody tr.even,
		table.dataTable tbody tr.even:hover,
		table.dataTable tbody tr.odd,
		table.dataTable tbody tr.odd:hover {
			background-color: #000000 !important; /* Set the background color as needed */
		}

		#balanceTable_wrapper {
			margin: 20px auto;
			width: 80%; /* Adjust the width as needed */
		}
		table.dataTable tbody tr {
			background-color: #000000 !important; /* Set the background color as needed */
		}
		

		/* Adjust the color of table rows during hover */
		table.dataTable tbody tr:hover {
			background-color: #333333 !important; /* Set the hover background color as needed */
		}
		/* Add these styles to customize the Date Range Filter */
		.daterangepicker {
			background-color: #000000 !important; /* Black background color */
			color: #ffffff !important; /* White text color */
		}

		.daterangepicker .calendar-time {
			background-color: #000000 !important; /* Black background color for time selection */
		}

		.daterangepicker .daterangepicker_input {
			background-color: #000000 !important; /* Black background color for input */
			color: #ffffff !important; /* White text color for input */
		}

		.daterangepicker .daterangepicker_input input {
			border-color: #555555 !important; /* Border color for input */
		}

		.daterangepicker .ranges li.active {
			background-color: #555555 !important; /* Darker background color for active range */
		}

		.daterangepicker .ranges li:hover {
			background-color: #444444 !important; /* Dark background color for hover effect */
		}

		.daterangepicker .ranges li.active::before {
			border-bottom-color: #555555 !important; /* Border color for active range indicator */
		}

		.daterangepicker .applyBtn, .daterangepicker .cancelBtn {
			background-color: #555555 !important; /* Dark background color for buttons */
			color: #ffffff !important; /* White text color for buttons */
		}

		.daterangepicker .applyBtn:hover, .daterangepicker .cancelBtn:hover {
			background-color: #444444 !important; /* Darker background color for button hover effect */
		}
		table.dataTable tbody tr.filter-row td {
			background-color: #000000 !important; /* Black background color for the filtered column */
			color: #ffffff !important; /* Light text color for the filtered column */
		}
		
	.category {
			background-color: black;
			color: white; /* Set the text color to white for better visibility */
		}
		
		#bar_chart .c3-axis-x-label,
		#bar_chart .c3-axis-y-label,
		#bar_chart .c3-axis-x .tick text,
		#bar_chart .c3-axis-y .tick text {
			fill: white !important;
		}
		#bar_chart .c3-tooltip {
    background-color: darkgray;
}

#bar_chart .c3-tooltip tr {
    color: white; /* Set the text color for better visibility on dark background */
}.c3-tooltip-container {
    background-color: darkgray !important;
    color: white !important;
}
	
 .transaction_edit_filter {
            display: flex;
            align-items: center;
        }
.spacer-label {
            padding: 0 10px; /* Adjust the padding as needed */
        }

.AddSubCategoryContainer {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
}
#addCategoryForm {
    display: flex;
    align-items: center;
    gap: 10px; /* Adjust the spacing between form elements */
    margin-bottom: 20px; /* Spacing below the form */
}

#category {
    width: 80ch; /* Set width of the dropdown */
}

#subcategory {
    width: 40ch; /* Set width of the text box */
}

    </style>
</head>
<body>
<a href="/" title="Go to Home">
        <i class="fas fa-home" style="color: #61DAFB; font-size: 24px;"></i>
    </a>
<h2>Category Management</h2>
<div class="AddSubCategoryContainer">   

 
    <form id="addCategoryForm">
		<select id="category" name="category" placeholder="Select Category" required></select>
        <input type="text" id="subcategory" name="subcategory" placeholder="Enter New Subcategory" required>        
        <button type="submit">Add</button>
    </form>
</div>
<div class="container">   
    <table id="categoryTable" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Delete</th>
                <th>SubCategoryKey</th>
                <th>Category</th>
                <th>SubCategory</th>
            </tr>
        </thead>
    </table>
</div>


<h2>Category Rule Management</h2>

<div class="containerRule">   
    <table id="categoryRuleTable" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Delete</th>
				<th>RuleKey</th>
                <th>Default_SubCategory</th>
                <th>Rule_Category</th>
                <th>Rule_Pattern</th>
				<th>Match_Word</th>
            </tr>
        </thead>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script>
$(document).ready(function() {
    var table = $('#categoryTable').DataTable({
        "ajax": {
            "url": "/getCategorySubCategory",
            "dataSrc": "data"  // Adjusted to correctly point to the data key in the JSON response
        },
		"orderClasses": false,
        "pageLength": 15,
		"columnDefs": [
					{
						"targets": [ 1 ], // The index of the SubCategoryKey column you want to hide
						"visible": false, // Set visibility to false
						"searchable": false
					}
				],
				"order": [[2, 'asc'], [3, 'asc']],	
        "columns": [
            {
                "data": "SubCategoryKey",
                "render": function(data, type, row) {
                    return '<button onclick="deleteSubCategory(' + data + ')">Delete</button>';
                }
            },
            { "data": "SubCategoryKey" },
			{ "data": "Category" },
            { 
                "data": "SubCategory",
                "render": function(data, type, row) {
                    if (type === 'display') {
                        return '<input type="text" value="' + data + '" onBlur="updateSubCategory(' + row.SubCategoryKey + ', this.value)">';
                    }
                    return data;
                }
            }
            
        ]
    });
	
	
	
	var table1 = $('#categoryRuleTable').DataTable({
        "ajax": {
            "url": "/getSubCategoryRules",
            "dataSrc": "data"
        },
        "orderClasses": false,
        "pageLength": 15,
        "columnDefs": [
            {
                "targets": [ 1 ],
                "visible": false,
                "searchable": false
            }
        ],
        "order": [[1, 'asc'], [2, 'asc'], [3, 'asc'], [4, 'asc']],
        "columns": [
            {
                "data": "RuleKey",
                "render": function(data, type, row) {
                    return '<button onclick="deleteRule(' + data + ')">Delete</button>';
                }
            },
            { "data": "RuleKey" },
            { "data": "Default_SubCategory" },
            { "data": "Rule_Category" },
            { "data": "Rule_Pattern" },         
            { 
                "data": "Match_Word",
                "render": function(data, type, row) {
                    if (type === 'display') {
                        return '<input type="text" value="' + data + '" onBlur="updateRule(' + row.RuleKey + ', this.value)">';
                    }
                    return data;
                }
            }           
        ]
    });

    $('#category').select2({
        width: '100%',
        ajax: {
            url: '/getCategory', // Adjust this to your endpoint for fetching unique categories
            processResults: function(data) {
                return {
                    results: $.map(data, function(item) {
                        return {
                            id: item.Category,
                            text: item.Category
                        };
                    })
                };
            }
        }
    });

    $('#addCategoryForm').on('submit', function(e) {
		e.preventDefault();
		$.ajax({
			url: '/addSubCategory',
			type: 'POST',
			data: $(this).serialize(),
			success: function(response) {
				// Check if the response indicates success
				if(response.success) {
					// Show an alert message
					alert(response.message); // "Category added successfully"
					// Reload the page
					window.location.reload();
				} else {
					// Handle the case where the operation wasn't successful
					alert("Failed to add category: " + response.message);
				}
			},
			error: function(xhr, status, error) {
				// Handle possible AJAX errors
				alert("An error occurred: " + error);
			}
		});
	});

});

function deleteSubCategory(subCategoryKey) {
    $.ajax({
        url: '/deleteSubCategory/' + subCategoryKey,
        type: 'DELETE',
        success: function(result) {
            $('#categoryTable').DataTable().ajax.reload();
        }
    });
}

function updateSubCategory(subCategoryKey, newSubCategoryName) {
    $.ajax({
        url: '/updateSubCategoryDIM',
        type: 'POST',
        data: {
            subcategory_key: subCategoryKey,
            new_subcategory_name: newSubCategoryName
        },
        success: function(response) {
            $('#categoryTable').DataTable().ajax.reload();
        }
    });
}



function updateRule(RuleKey, Match_Word) {
    $.ajax({
        url: '/updateRule',
        type: 'POST',
        data: {
            RuleKey: RuleKey,
            Match_Word: Match_Word
        },
        success: function(response) {
            $('#categoryTable').DataTable().ajax.reload();
        }
    });
}


function deleteRule(RuleKey) {
    $.ajax({
        url: '/deleteRule/' + RuleKey,
        type: 'DELETE',
        success: function(result) {
            $('#categoryTable').DataTable().ajax.reload();
        }
    });
}


</script>
</body>
</html>
